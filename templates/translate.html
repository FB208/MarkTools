{% extends "_base.html" %}

{% block title %}翻译页面{% endblock %}

{% block head %}
<style>
  .container {
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    padding: 20px;
    box-sizing: border-box;
  }

  .textarea-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    margin: 0 20px;
    width: 100%;
    max-width: 600px;
  }

  .textarea {
    width: 100%;
    min-height: 150px;
    max-height: 80vh;
    border-radius: 15px;
    padding: 10px;
    border: 1px solid #4b5563; /* Darker border for dark mode */
    resize: none;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    overflow-y: auto;
    background-color: #1f2937; /* Dark background */
    color: #d1d5db; /* Light text color */
  }

  .buttons {
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  .button {
    margin: 10px 0;
    padding: 10px 20px;
    border: none;
    background-color: #3b82f6; /* Blue button */
    color: white;
    border-radius: 5px;
    cursor: pointer;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    transition: background-color 0.3s, transform 0.3s;
  }

  .button:hover {
    background-color: #2563eb; /* Darker blue on hover */
    transform: scale(1.05);
  }

  label {
    margin-bottom: 5px;
    font-weight: bold;
    color: #d1d5db; /* Light text color */
  }
</style>
{% endblock %}

{% block body %}

<div class="container">
  <div class="textarea-container">
    <label for="chinese">中文</label>
    <textarea id="chinese" class="textarea" oninput="autoResize(this)"></textarea>
  </div>
  <div class="buttons">
    <button class="button" onclick="do_translate('zh_to_en')">→</button>
    <button class="button" onclick="do_translate('en_to_zh')">←</button>
  </div>
  <div class="textarea-container">
    <label for="english">英文</label>
    <textarea id="english" class="textarea" oninput="autoResize(this)"></textarea>
  </div>
</div>

<!-- 提示组件 -->
<div id="success-toast" class="fixed top-4 right-4 hidden bg-green-500 text-white px-4 py-2 rounded shadow-lg">
  翻译成功！
</div>

<script>
  $(document).ready(function() {
    // 清空cookie
    $.removeCookie('mt_chinese_old');
    $.removeCookie('mt_english_old');
  });

  function autoResize(textarea) {
    textarea.style.height = 'auto';
    textarea.style.height = (textarea.scrollHeight) + 'px';
  }

  function showSuccessToast() {
    const toast = document.getElementById('success-toast');
    toast.classList.remove('hidden');
    setTimeout(() => {
      toast.classList.add('hidden');
    }, 3000); // 3秒后隐藏提示
  }

  function do_translate(direction) {
    const chineseText = $('#chinese').val();
    const englishText = $('#english').val();
    const chineseOld = $.cookie('mt_chinese_old') || '';
    const englishOld = $.cookie('mt_english_old') || '';

    $.ajax({
      url: '/do_translate',
      method: 'POST',
      contentType: 'application/json',
      data: JSON.stringify({
        direction: direction,
        chinese: chineseText,
        english: englishText,
        chinese_old: chineseOld,
        english_old: englishOld
      }),
      success: function(data) {
        if (direction === 'zh_to_en') {
          $('#english').val(data.translation);
          $.cookie('mt_chinese_old', chineseText);
          $.cookie('mt_english_old', data.translation);
        } else if (direction === 'en_to_zh') {
          $('#chinese').val(data.translation);
          $.cookie('mt_english_old', englishText);
          $.cookie('mt_chinese_old', data.translation);
        }
        autoResize(document.getElementById('english'));
        autoResize(document.getElementById('chinese'));
        showSuccessToast(); // 显示成功提示
      },
      error: function(error) {
        console.error('Error:', error);
      }
    });
  }
</script>

{% endblock %}