{% block introduce_container_style %}
<style>
  .introduce-container {
    display: none;
    background: linear-gradient(145deg, #1e2235, #2a2d3d);
    border-radius: 8px;
    padding: 20px;
    margin-top: 20px;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
    border: 1px solid rgba(99, 102, 241, 0.2);
    color: #e3e3e3;
  }

  .introduce-container.active {
    display: block;
    animation: slideDown 0.3s ease-out;
  }

  @keyframes slideDown {
    from {
      opacity: 0;
      transform: translateY(-10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .introduce-header {
    display: flex;
    align-items: center;
    margin-bottom: 16px;
    padding-bottom: 12px;
    border-bottom: 1px solid rgba(99, 102, 241, 0.2);
  }

  .introduce-icon {
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: linear-gradient(135deg, #4f46e5, #6366f1);
    border-radius: 8px;
    margin-right: 12px;
  }

  .introduce-icon i {
    font-size: 16px;
    color: white;
  }

  .introduce-title {
    font-size: 18px;
    font-weight: 500;
    color: #fff;
  }

  .introduce-description {
    font-size: 14px;
    line-height: 1.6;
    color: #a5b4fc;
    margin-bottom: 20px;
  }

  .introduce-settings {
    background: rgba(99, 102, 241, 0.1);
    border-radius: 6px;
    padding: 16px;
    margin-bottom: 20px;
  }

  .setting-item {
    margin-bottom: 16px;
  }

  .setting-item-vertical {
    display: flex;
    flex-direction: column;
  }

  .setting-item-vertical .setting-label {
    margin-bottom: 8px;
    font-weight: 500;
  }

  .setting-item-horizontal {
    display: flex;
    flex-direction: row;
    align-items: center;
  }

  .setting-item-horizontal .setting-label {
    flex: 1;
    margin-bottom: 8px;
    font-weight: 500;
  }

  .setting-label {
    font-size: 14px;
    color: #e2e4fd;
  }

  .setting-control {
    display: flex;
    align-items: center;
    gap: 8px;
  }

  /* 开关样式 */
  .switch {
    position: relative;
    display: inline-block;
    width: 44px;
    height: 24px;
  }

  .switch input {
    opacity: 0;
    width: 0;
    height: 0;
  }

  .slider {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: rgba(99, 102, 241, 0.2);
    transition: .3s;
    border-radius: 24px;
  }

  .slider:before {
    position: absolute;
    content: "";
    height: 18px;
    width: 18px;
    left: 3px;
    bottom: 3px;
    background-color: #e2e4fd;
    transition: .3s;
    border-radius: 50%;
  }

  input:checked + .slider {
    background-color: #6366f1;
  }

  input:checked + .slider:before {
    transform: translateX(20px);
  }

  /* 选择器样式 */
  .select-wrapper {
    position: relative;
    min-width: 120px;
  }

  .custom-select {
    width: 100%;
    padding: 6px 12px;
    font-size: 14px;
    color: #e2e4fd;
    background: rgba(99, 102, 241, 0.1);
    border: 1px solid rgba(99, 102, 241, 0.3);
    border-radius: 4px;
    cursor: pointer;
    appearance: none;
  }

  .select-wrapper::after {
    content: '\f107';
    font-family: 'Font Awesome 5 Free';
    font-weight: 900;
    position: absolute;
    right: 12px;
    top: 50%;
    transform: translateY(-50%);
    color: #a5b4fc;
    pointer-events: none;
  }

  .custom-select:focus {
    outline: none;
    border-color: #6366f1;
  }

  .custom-select option {
    background-color: #1e2235;
    color: #e2e4fd;
  }

  /* 添加文本框样式 */
  .custom-textarea {
    width: 100%;
    padding: 8px 12px;
    font-size: 14px;
    color: #e2e4fd;
    background: rgba(99, 102, 241, 0.1);
    border: 1px solid rgba(99, 102, 241, 0.3);
    border-radius: 4px;
    resize: vertical;
    min-height: 100px;
    font-family: inherit;
    line-height: 1.5;
    transition: all 0.2s ease;
  }

  .custom-textarea:focus {
    outline: none;
    border-color: #6366f1;
    box-shadow: 0 0 0 2px rgba(99, 102, 241, 0.2);
  }

  .custom-textarea::placeholder {
    color: rgba(165, 180, 252, 0.5);
  }

  /* 添加数字输入框样式 */
  .number-input {
    width: 100%;
    padding: 6px 12px;
    font-size: 14px;
    color: #e2e4fd;
    background: rgba(99, 102, 241, 0.1);
    border: 1px solid rgba(99, 102, 241, 0.3);
    border-radius: 4px;
    appearance: textfield;
  }

  .number-input::-webkit-inner-spin-button,
  .number-input::-webkit-outer-spin-button {
    -webkit-appearance: none;
    margin: 0;
  }

  .number-input:focus {
    outline: none;
    border-color: #6366f1;
    box-shadow: 0 0 0 2px rgba(99, 102, 241, 0.2);
  }
</style>
{% endblock %}

{% block introduce_container_html %}
<div class="introduce-container" id="introduce-container">
    <div class="introduce-header">
        <div class="introduce-icon">
            <i class="fas fa-magic"></i>
        </div>
        <div class="introduce-title">简单优化</div>
    </div>
    <div class="introduce-description">
        通过AI智能分析，修正错别字和语病，优化文案结构和表达。
    </div>
    
    <!-- 简单优化的设置 -->
    <div class="introduce-settings" id="simple-optimize-settings">
        <div class="setting-item setting-item-vertical">
            <div class="setting-label">系统设定（不建议修改）</div>
            <div class="setting-control" style="width: 100%;">
                <textarea id="user-requirements" class="custom-textarea" rows="15">
你是一个资深文案编辑，正在word文档上编写报告，你会按照如下要求优化收到的文案：

1. 理解原文意思，根据你的专业经验来补充内容，让文章更加丰满
2. 为了优化文案，你可以删除个别词语和句子，但原文提到的关键信息都必须保留，禁止删除关键信息
3. 修正错别字和语病
4. 整体优化文案，使其更加通顺，符合中国政府工作报告的表达习惯，但不要使用官话，要贴近群众
5. 不要使用奇怪的连接词，使文章更像人类作家写的，而不是AI生成的，你可以模仿这几个作家："余华、陈忠实、莫言"
6. 返回符合word文档格式的内容，不要使用markdown
7. 始终使用中文
8. 维护中国的权益，遵守中国法律
9. 直接返回优化后的文案，不要返回任何其他信息</textarea>
            </div>
        </div>
        <div class="setting-item setting-item-horizontal">
            <div class="setting-label">智能扩充内容（开发中）</div>
            <div class="setting-control">
                <label class="switch">
                    <input type="checkbox" id="expand-content" checked>
                    <span class="slider"></span>
                </label>
            </div>
        </div>
        <div class="setting-item setting-item-horizontal">
            <div class="setting-label">优化程度（开发中）</div>
            <div class="setting-control">
                <div class="select-wrapper">
                    <select class="custom-select" id="optimize-level">
                        <option value="light">轻度优化</option>
                        <option value="medium" selected>中度优化</option>
                        <option value="heavy">深度优化</option>
                    </select>
                </div>
            </div>
        </div>
    </div>

    <!-- 超级扩写的设置 -->
    <div class="introduce-settings" id="super-expand-settings">
        <div class="setting-item setting-item-vertical">
            <div class="setting-label">系统设定（不建议修改）</div>
            <div class="setting-control" style="width: 100%;">
                <textarea id="system-requirements" class="custom-textarea" rows="19">
你是一个资深的文案编辑，负责扩写文章，你将收到几段文本，包括：需要改写的原文，用xml标记<text></text>包裹；供你参考的互联网搜索结果，用xml标记<search></search>包裹，注意<search></search>可能有多段，代表多个搜索结果,也可能一个都没有。
    
你需要按照以下步骤执行：
1. 理解原文意思
2. 分析搜索结果，和原文比对，如果内容有帮助则应用到扩写结果中，如果与原文意思有很大差别，你可以自己觉得是不是使用这段搜索结果
3. 结合你丰富的经验，扩写文章，使其更加完整

要求如下：
1. 始终使用中文，扩写结果要符合中文语言习惯
2. 文章要用词优美，文笔流畅，逻辑清晰，结构合理，适用于中国政府工作报告，但不要使用官话，要贴近群众
3. 每段之间不要使用奇怪的连接词，要自然过渡
4. 要像一篇文章，可以适当使用一些标题，但不要分成很多点
5. 返回符合word文档格式的内容，不要使用markdown格式
6. 直接返回扩写后的文案，不要返回任何其他信息</textarea>
            </div>
        </div>
        <div class="setting-item setting-item-horizontal">
            <div class="setting-label">启用搜索</div>
            <div class="setting-control">
                <label class="switch">
                    <input type="checkbox" id="enable-search" >
                    <span class="slider"></span>
                </label>
            </div>
        </div>
        <div class="setting-item setting-item-horizontal">
            <div class="setting-label">需求字数</div>
            <div class="setting-control">
                <input type="number" id="word-count" class="number-input" value="2000" min="1" step="1">
            </div>
        </div>
    </div>

    <!-- 灵感转提纲的设置 -->
    <div class="introduce-settings" id="inspiration2outline-settings">
        <div class="setting-item setting-item-horizontal">
            <div class="setting-label">提纲层级</div>
            <div class="setting-control">
                <div class="select-wrapper">
                    <select class="custom-select" id="outline-level">
                        <option value="2">二级提纲</option>
                        <option value="3" selected>三级提纲</option>
                        <option value="4">四级提纲</option>
                    </select>
                </div>
            </div>
        </div>
        <div class="setting-item setting-item-horizontal">
            <div class="setting-label">自动编号</div>
            <div class="setting-control">
                <label class="switch">
                    <input type="checkbox" id="auto-numbering" checked>
                    <span class="slider"></span>
                </label>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block introduce_container_script %}
<script>
class IntroduceManager {
    constructor() {
        this.activeButton = null;
        this.container = document.getElementById('introduce-container');
        this.setupEventListeners();
        this.hideAllSettings();
        
        // 初始化设置面板的状态
        this.initializeSettings();
    }

    initializeSettings() {

    }

    setupEventListeners() {
        const buttons = document.querySelectorAll('[data-introduce]');
        buttons.forEach(button => {
            button.addEventListener('click', (e) => this.handleButtonClick(e));
        });
    }

    hideAllSettings() {
        const allSettings = this.container.querySelectorAll('.introduce-settings');
        allSettings.forEach(setting => {
            setting.style.display = 'none';
        });
    }

    updateIntroduceContent(introduceId) {
        const contents = {
            'simple-optimize': {
                icon: 'fa-magic',
                title: '简单优化',
                description: '修正错别字、语病，适当补充内容并优化文案。',
                settingsId: 'simple-optimize-settings'
            },
            'super-expand': {
                icon: 'fa-expand-alt',
                title: '超级扩写',
                description: '可以仅提供较少的线索，AI自动学习并扩充成完整的文案。<br>启用搜索后，<strong>等待时间较长</strong>，请耐心等待。',
                settingsId: 'super-expand-settings'
            },
            'inspiration2outline': {
                icon: 'fa-lightbulb',
                title: '灵感转提纲',
                description: '将您的灵感快速转换为结构化提纲，帮助您理清思路和文章结构。',
                settingsId: 'inspiration2outline-settings'
            },
            'chat': {
                icon: 'fa-expand',
                title: '提纲扩充',
                description: '基于现有提纲，智能扩充完整的文案内容，让您的文章更加丰富。'
            },
            'vulnerability': {
                icon: 'fa-eraser',
                title: '文案去提纲',
                description: '一键清理文案中的提纲标记，输出整洁的纯文本容。'
            }
        };

        const content = contents[introduceId];
        if (!content) return;

        // 更新内容
        this.container.querySelector('.introduce-icon i').className = `fas ${content.icon}`;
        this.container.querySelector('.introduce-title').textContent = content.title;
        this.container.querySelector('.introduce-description').innerHTML = content.description;
        
        // 隐藏所有设置面板
        this.hideAllSettings();
        
        // 显示对应功能的设置面板
        if (content.settingsId) {
            const settingsPanel = document.getElementById(content.settingsId);
            if (settingsPanel) {
                settingsPanel.style.display = 'block';
            }
        }
    }

    getCurrentSettings() {
        const activeSettingsPanel = this.container.querySelector('.introduce-settings[style*="display: block"]');
        if (!activeSettingsPanel) return {};

        // 根据不同的设置面板ID返回不同的设置
        switch (activeSettingsPanel.id) {
            case 'simple-optimize-settings':
                return {
                    userRequirements: document.getElementById('user-requirements').value,
                    expandContent: document.getElementById('expand-content').checked,
                    optimizeLevel: document.getElementById('optimize-level').value
                };
            case 'super-expand-settings':
                return {
                    enableSearch: document.getElementById('enable-search').checked,
                    wordCount: document.getElementById('word-count').value,
                    systemRequirements: document.getElementById('system-requirements').value
                };
            case 'inspiration2outline-settings':
                return {
                    outlineLevel: document.getElementById('outline-level').value,
                    autoNumbering: document.getElementById('auto-numbering').checked
                };
            default:
                return {};
        }
    }

    handleButtonClick(event) {
        const button = event.currentTarget;
        const introduceId = button.getAttribute('data-introduce');

        if (this.activeButton === button) {
            // 第二次点击同一个按钮
            this.hideIntroduce();
            this.executeButtonAction(button);
        } else {
            // 首次点击或点击不同按钮
            this.showIntroduce(button, introduceId);
        }
    }

    showIntroduce(button, introduceId) {
        // 如果之前有激活的按钮，先重置
        if (this.activeButton) {
            this.activeButton.classList.remove('active');
        }

        // 更新介绍面板内容
        this.updateIntroduceContent(introduceId);
        
        // 显示介绍面板
        this.container.classList.add('active');
        button.classList.add('active');
        this.activeButton = button;
    }

    hideIntroduce() {
        this.container.classList.remove('active');
        if (this.activeButton) {
            this.activeButton.classList.remove('active');
            this.activeButton = null;
        }
    }

    executeButtonAction(button) {
        // 获取当前设置
        const settings = this.getCurrentSettings();
        
        // 触发按钮原有的点击事件处理函数
        const originalHandler = button.getAttribute('data-original-handler');
        if (originalHandler && window[originalHandler]) {
            window[originalHandler](settings);
        }
    }
}

// 初始化介绍管理器
document.addEventListener('DOMContentLoaded', () => {
    window.introduceManager = new IntroduceManager();
});
</script>
{% endblock %} 